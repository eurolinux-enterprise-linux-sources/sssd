From fbe3bb686b985f3965d7cf79558e0f6229188ae8 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Pavel=20B=C5=99ezina?= <pbrezina@redhat.com>
Date: Fri, 18 Dec 2015 14:23:56 +0100
Subject: [PATCH 14/46] SDAP: support empty filters in sdap_combine_filters()

Reviewed-by: Sumit Bose <sbose@redhat.com>
(cherry picked from commit 1d3f5fc2802c218916e6d6bc98eeaed79c66bafe)
---
 src/providers/ldap/sdap_utils.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/src/providers/ldap/sdap_utils.c b/src/providers/ldap/sdap_utils.c
index 7a96f81a1db2644b698e5a5baaed19366a305c6b..47921b8768b9c4c4b2d40a5eb28e28bf48238210 100644
--- a/src/providers/ldap/sdap_utils.c
+++ b/src/providers/ldap/sdap_utils.c
@@ -155,8 +155,10 @@ char *sdap_combine_filters(TALLOC_CTX *mem_ctx,
 {
     char *filter = NULL;
 
-    if (!extra_filter) {
+    if (extra_filter == NULL || extra_filter[0] == '\0') {
         return talloc_strdup(mem_ctx, base_filter);
+    } else if (base_filter == NULL || base_filter[0] == '\0') {
+        return talloc_strdup(mem_ctx, extra_filter);
     }
 
     if (extra_filter[0] == '(') {
@@ -166,5 +168,6 @@ char *sdap_combine_filters(TALLOC_CTX *mem_ctx,
         filter = talloc_asprintf(mem_ctx, "(&%s(%s))",
                                  base_filter, extra_filter);
     }
+
     return filter; /* NULL or not */
 }
-- 
2.4.3

